var tag = document.createElement('script');

tag.src = "https://www.youtube.com/iframe_api";
var firstScriptTag = document.getElementsByTagName('script')[0];
firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);

var players = [];
// var playersIDs = []; // add to for .length
function onYouTubeIframeAPIReady() {
    for(i = 0; i < 3; i++) {
        $('#test').append( () => {
            var playerDiv =  document.createElement('div');
            var carouselDiv = document.createElement('div');
            $(carouselDiv).append(playerDiv);
            $(playerDiv).attr('id', 'player' + i);
            $(carouselDiv).attr('class', 'carousel-item audiovisual');
            return carouselDiv;
        });
        players.push(new YT.Player('player' + i, {
          height: '360',
          width: '640',
          videoId: 'M7lc1UVf-VE',
          playerVars: {
              'rel': 0,
              'controls': 2
            },
          events: {
            'onStateChange': onPlayerStateChange
            }
        }));
    }
    $('#player0').parent().attr('class', 'carousel-item audiovisual active');
}

function onPlayerStateChange(event) {
    if(event.data == YT.PlayerState.PLAYING) {
        $('.carousel').carousel('pause');
    }
    if(event.data == YT.PlayerState.PAUSED) {
        $('.carousel').carousel('cycle');
    }
}

$(() => {
    $('#audiovisual-media-container.carousel').on('slide.bs.carousel', () => {
        players.forEach((player, index, array) => {
            if(player.getPlayerState == 1) {
                player.pauseVideo();
            }
        });
    });
});

function openMail() {
    var contact = $("#contact").val();
    if (contact == '')
        contact = '[Seu nome e contato aqui!]';
    var body = $("#body").val();
    window.open('mailto:ricklistrado@gmail.com?subject=' +
    'Vi seu portf√≥lio e gostaria de entrar em contato' +
    '&body=' + encodeURIComponent(body + '\n\nAtenciosamente\n' + contact));
}
